
<input type="text" name="attr_debug" style="display: none;" value=" "/>
<div class="top">
  <div class="topStats" style="margin-bottom: 1em;">
    <div>
      <div class="inlineBlock" style="position: relative;"><img src="https://raw.githubusercontent.com/Cazra/MLPRIM5Roll20CharSheet_DashGalaxy/master/img/perkLevel.png"/>
        <div class="graphicalField">
          <input type="number" name="attr_perk_level" style="left: 19px; top: 43px; font-size: 2em; font-family: sans-serif; width: 32px; text-align: center;"/>
        </div>
        <div class="graphicalField">
          <input type="text" name="attr_character_name" style="left: 80px; top: 47px; font-size: 1.5em; font-family: sans-serif; width: 240px;"/>
        </div>
      </div>
      <div class="inlineBlock" style="position: relative; vertical-align: top; width: 4in;">
        <div class="labelledUnderlined" style="position: absolute; top: 45px;">
          <label>Player Name</label>
          <div class="inner">
            <input type="text" name="attr_player_name"/>
          </div>
        </div>
      </div>
    </div>
    <div style="margin-top: -28px; margin-left: 64px;">
      <div class="labelledUnderlined" style="width: 1.5in;">
        <label>Race</label>
        <div class="inner">
          <input type="text" name="attr_race"/>
        </div>
      </div>
      <div class="labelledUnderlined" style="width: 2in;">
        <label>Job</label>
        <div class="inner">
          <input type="text" name="attr_classes"/>
        </div>
      </div>
      <div class="labelledUnderlined" style="width: 2in;">
        <label>Virtue</label>
        <div class="inner">
          <input type="text" name="attr_virtue"/>
        </div>
      </div>
      <div class="labelledUnderlined" style="width: 2in;">
        <label>Flaw</label>
        <div class="inner">
          <input type="text" name="attr_flaw"/>
        </div>
      </div>
      <div class="labelledUnderlined" style="width: 2in;">
        <label>Quirks</label>
        <div class="inner">
          <input type="text" name="attr_quirks"/>
        </div>
      </div>
      <div class="labelledUnderlined" style="width: 3in;">
        <label>Active Status Conditions</label>
        <div class="inner">
          <input type="text" name="attr_activeConditions"/>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="tabsContainer">
  <div class="tab">
    <input type="radio" id="tab_1" name="mainTabs" checked="checked"/>
    <label for="tab_1">Core</label>
    <div class="tabPanel">
      <div>TEST core</div>
    </div>
  </div>
  <div class="tab">
    <input type="radio" id="tab_2" name="mainTabs"/>
    <label for="tab_2">Skills</label>
    <div class="tabPanel">
      <div>TEST skills</div>
    </div>
  </div>
  <div class="tab">
    <input type="radio" id="tab_3" name="mainTabs"/>
    <label for="tab_3">Perks</label>
    <div class="tabPanel">
      <div>TEST perks</div>
    </div>
  </div>
  <div class="tab">
    <input type="radio" id="tab_4" name="mainTabs"/>
    <label for="tab_4">Powers/Abilities</label>
    <div class="tabPanel">
      <div>TEST powers</div>
    </div>
  </div>
  <div class="tab">
    <input type="radio" id="tab_5" name="mainTabs"/>
    <label for="tab_5">Gear/Equipment</label>
    <div class="tabPanel">
      <div>TEST gear</div>
    </div>
  </div>
  <div class="tab">
    <input type="radio" id="tab_6" name="mainTabs"/>
    <label for="tab_6">Notes</label>
    <div class="tabPanel">
      <div>TEST notes</div>
    </div>
  </div>
</div>
<script type="text/worker">/**
 * Forces an update on a list of numerical fields, also making sure that
 * any undefined fields are set to 0.
 * @param {string[]} attrs
 * @param {function} cb
 */
function forceUpdate(attrs, cb) {
  parseAttrs(attrs, values => {
    let tempValues = {};
    _.each(attrs, attr => {
      tempValues[attr] = -9999;
    });
    setAttrs(tempValues);
    setAttrs(values);
  });
}


function onChange(attrs, cb) {
  attrs = _.map(attrs, attr => {
    return 'change:' + attr;
  }).join(' ');
  on(attrs, cb);
}

function onChangeParse(attrs, cb) {
  onChange(attrs, () => {
    parseAttrs(attrs, cb);
  });
}

/**
 * Gets the specified attributes and parses them as an integer or 0.
 */
function parseAttrs(attrs, cb) {
  getAttrs(attrs, function(values) {
    _.each(attrs, function(attr) {
      if(_.isUndefined(values[attr]))
        values[attr] = 0;
      else if(!isNaN(values[attr]))
        values[attr] = parseInt(values[attr]);
    });
    cb(values);
  });
}

</script>
<rolltemplate class="sheet-rolltemplate-pf">
  <table>
    <thead>
      <tr>
        <th>{{charName}} &#x21D2; {{attr}}</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Result {{result}}</td>
      </tr>{{#notes}}
      <tr>
        <td class="notes">
          <div>Notes:</div>
          <div>{{notes}}</div>
        </td>
      </tr>{{/notes}}
    </tbody>
  </table>
</rolltemplate>